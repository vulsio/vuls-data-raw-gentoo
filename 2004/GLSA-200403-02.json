{
  "ID": "200403-02",
  "Title": "Linux kernel do_mremap local privilege escalation vulnerability",
  "Synopsis": "\n    A critical security vulnerability has been found in recent Linux kernels by\n    Paul Starzetz of iSEC Security Research which allows for local privilege\n    escalations.\n  ",
  "Product": {
    "Text": "Kernel",
    "Type": "ebuild"
  },
  "Announced": "2004-03-05",
  "Revised": {
    "Text": "2006-05-22",
    "Count": "03"
  },
  "Bug": [
    "42024"
  ],
  "Access": "local",
  "Affected": {
    "Package": [
      {
        "Name": "sys-kernel/aa-sources",
        "Auto": "no",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.23-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.23-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/alpha-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.21-r4",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.21-r4",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/ck-sources",
        "Auto": "no",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r1",
            "Range": "eq",
            "Slot": ""
          },
          {
            "Text": "2.6.2-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.2-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/compaq-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.9.32.7-r2",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.9.32.7-r2",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/development-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.6.3_rc1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.3_rc1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/gaming-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.20-r8",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.20-r8",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/gentoo-dev-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.6.3_rc1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.3_rc1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/gentoo-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.19-r11",
            "Range": "eq",
            "Slot": ""
          },
          {
            "Text": "2.4.20-r12",
            "Range": "eq",
            "Slot": ""
          },
          {
            "Text": "2.4.22-r7",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.22-r7",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/grsec-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24.1.9.13-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24.1.9.13-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/gs-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.25_pre7-r2",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.25_pre7-r2",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/hardened-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/hppa-dev-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.6.2_p3-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.2_p3-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/hppa-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24_p0-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24_p0-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/ia64-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/mips-prepatch-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.25_pre6-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.25_pre6-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/mips-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.25_rc4",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.25_rc4",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/mm-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.6.3_rc1-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.3_rc1-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/openmosix-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.22-r4",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.22-r4",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/pac-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.23-r3",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.23-r3",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/planet-ccrma-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.21-r5",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.21-r5",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/ppc-development-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.6.3_rc1-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.3_rc1-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/ppc-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/ppc-sources-benh",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.22-r5",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.22-r5",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/ppc-sources-crypto",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.20-r3",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.20-r3",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/ppc-sources-dev",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r2",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24-r2",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/selinux-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r2",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24-r2",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/sparc-dev-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.6.3_rc1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.3_rc1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/sparc-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r2",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24-r2",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/usermode-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r1",
            "Range": "rge",
            "Slot": ""
          },
          {
            "Text": "2.4.26",
            "Range": "rge",
            "Slot": ""
          },
          {
            "Text": "2.6.3-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.3-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/vanilla-prepatch-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.25_rc4",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.25_rc4",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/vanilla-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.25",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.25",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/win4lin-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.23-r2",
            "Range": "eq",
            "Slot": ""
          },
          {
            "Text": "2.6.2-r1",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.6.2-r1",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/wolk-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "4.9-r4",
            "Range": "eq",
            "Slot": ""
          },
          {
            "Text": "4.10_pre7-r3",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "4.10_pre7-r3",
            "Range": "lt",
            "Slot": ""
          }
        ]
      },
      {
        "Name": "sys-kernel/xfs-sources",
        "Auto": "yes",
        "Arch": "*",
        "Unaffected": [
          {
            "Text": "2.4.24-r2",
            "Range": "ge",
            "Slot": ""
          }
        ],
        "Vulnerable": [
          {
            "Text": "2.4.24-r2",
            "Range": "lt",
            "Slot": ""
          }
        ]
      }
    ],
    "Service": {
      "Text": "",
      "Type": "",
      "Fixed": ""
    }
  },
  "Background": {
    "Text": "\n    <p>\n    The Linux kernel is responsible for memory management in a working\n    system - to allow this, processes are allowed to allocate and\n    unallocate memory.\n    </p>\n  "
  },
  "Description": {
    "Text": "\n    <p>\n    The memory subsystem allows for shrinking, growing, and moving of\n    chunks of memory along any of the allocated memory areas which the\n    kernel posesses.\n    </p>\n    <p>\n    To accomplish this, the do_mremap code calls the do_munmap() kernel\n    function to remove any old memory mappings in the new location - but,\n    the code doesn't check the return value of the do_munmap() function\n    which may fail if the maximum number of available virtual memory area\n    descriptors has been exceeded.\n    </p>\n    <p>\n    Due to the missing return value check after trying to unmap the middle\n    of the first memory area, the corresponding page table entries from the\n    second new area are inserted into the page table locations described by\n    the first old one, thus they are subject to page protection flags of\n    the first area. As a result, arbitrary code can be executed.\n    </p>\n  "
  },
  "Impact": {
    "Type": "high",
    "Text": "\n    <p>\n    Arbitrary code with normal non-super-user privelerges may be able to\n    exploit this vulnerability and may disrupt the operation of other parts\n    of the kernel memory management subroutines finally leading to\n    unexpected behavior.\n    </p>\n    <p>\n    Since no special privileges are required to use the mremap() and\n    mummap() system calls any process may misuse this unexpected behavior\n    to disrupt the kernel memory management subsystem. Proper exploitation\n    of this vulnerability may lead to local privilege escalation allowing\n    for the execution of arbitrary code with kernel level root access.\n    </p>\n    <p>\n    Proof-of-concept exploit code has been created and successfully tested,\n    permitting root escalation on vulnerable systems. As a result, all\n    users should upgrade their kernels to new or patched versions.\n    </p>\n  "
  },
  "Workaround": {
    "Text": "\n    <p>\n    Users who are unable to upgrade their kernels may attempt to use\n    \"sysctl -w vm.max_map_count=1000000\", however, this is a temporary fix\n    which only solves the problem by increasing the number of memory areas\n    that can be created by each process. Because of the static nature of\n    this workaround, it is not recommended and users are urged to upgrade\n    their systems to the latest avaiable patched sources.\n    </p>\n  "
  },
  "Resolution": {
    "Text": "\n    \n    \n  ",
    "P": [
      {
        "Text": "\n    Users are encouraged to upgrade to the latest available sources for\n    their system:\n    ",
        "URI": {
          "Text": "",
          "Link": ""
        },
        "Br": null,
        "I": null,
        "Code": "",
        "P": ""
      }
    ],
    "Code": [
      "\n    # emerge sync\n    # emerge -pv your-favourite-sources\n    # emerge your-favourite-sources\n    # # Follow usual procedure for compiling and installing a kernel.\n    # # If you use genkernel, run genkernel as you would do normally.\n    \n    # # IF YOUR KERNEL IS MARKED as \"remerge required!\" THEN\n    # # YOU SHOULD UPDATE YOUR KERNEL EVEN IF PORTAGE\n    # # REPORTS THAT THE SAME VERSION IS INSTALLED."
    ]
  },
  "References": {
    "URI": [
      {
        "Text": "Advisory released by iSEC",
        "Link": "http://isec.pl/vulnerabilities/isec-0014-mremap-unmap.txt"
      },
      {
        "Text": "CVE-2004-0077",
        "Link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0077"
      }
    ]
  },
  "Metadata": [
    {
      "Text": "\n    koon\n  ",
      "Tag": "submitter",
      "Timestamp": "2005-04-02T12:59:08Z"
    }
  ]
}
